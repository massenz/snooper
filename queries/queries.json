{
    "queries": {
        "get_user_by_id": {
            "sql": "SELECT * FROM USERS WHERE UUID=%(id)s",
            "drill_down": {
                "email_address": "/api/1/query/get_user_by_email/email/$"
            },
            "params": [{
                "label": "User UUID",
                "name": "id"
            }]
        },

        "get_user_by_email": {
            "sql": "select uuid, email_address, first_name, last_name, api_key from users where email_address like %(email)s",
            "drill_down": {
                "uuid": "/api/1/query/get_user_by_id/id/$"
            },
            "params": [{
                "label": "User email",
                "name": "email"
            }]
        },

        "get_migration": {
            "sql":  "select source.uuid \"Source UUID\", source.host host, source.os OS, source.state \"Source State\", source.selected_drives \"Selected drives\", source.available_drives \"Available drives\", step.name \"name\", step.status \"status\", step.execution_start \"start\", step.execution_end \"end\", step.detail \"detail\", task.organization \"org\", task.execution_start \"migration start\", task.execution_end \"migration end\" from task, step, source_machine as source where task.id = step.task_id and step.source_machine_ref = source.id and task.id = %(task.id)s",
            "drill_down": {
                "Source UUID": "/api/1/query/get_source_by_uuid/uuid/$",
                "host": "/api/1/query/get_source_by_hostname/hostname/$",
                "OS": "/api/1/query/get_all_migration_by_os/os/$/step_status/COMPLETED_SUCCESS"
            },
            "params": [{
                "label": "Task ID",
                "name": "task.id"
            }]
        },

        "get_all_migrations": {
            "sql":  "select source.uuid \"Source UUID\", source.host host, source.os OS, source.state \"Source State\", source.selected_drives \"Selected drives\", source.available_drives \"Available drives\", step.name \"name\", step.status \"status\", step.execution_start \"start\", step.execution_end \"end\", step.detail \"detail\", task.organization \"org\", task.execution_start \"migration start\", task.execution_end \"migration end\" from task, step, source_machine as source where task.id = step.task_id and step.source_machine_ref = source.id",
            "drill_down": {
                "Source UUID": "/api/1/query/get_source_by_uuid/uuid/$",
                "host": "/api/1/query/get_source_by_hostname/hostname/$",
                "OS": "/api/1/query/get_all_migration_by_os/os/$/step_status/COMPLETED_SUCCESS"
            }
        },

        "get_users_by_role": {
            "sql": "SELECT uuid,email_address,first_name,last_name FROM users WHERE role=%(role)s",
            "drill_down": {
                "uuid": "/api/1/query/get_user_by_id/id/$"
            },
            "params": [{
                "label": "User Role",
                "name": "role"
            }]
        },

        "get_success_duration": {
            "sql": "select task.id \"Migration ID\", date(step.status_recorded_at) \"Date\", source_machine.host, source_machine.selected_drives \"Drives\", (step.status_recorded_at - step.execution_start) \"Duration\" from source_machine, step, task where source_machine.id = step.source_machine_ref AND step.name = 'CollectDataStep' and step.status = 'COMPLETED_SUCCESS' and task.id = step.task_id order by step.status_recorded_at ASC",
            "drill_down": {
                "Migration ID": "/api/1/query/get_migration/task.id/$"
            }
        },

        "migrations_by_date": {
            "sql": "select date(task.execution_end), task.name, status, count (status) from task where task.name like '%igrationTask%' group by task.name, date(task.execution_end), status order by date(task.execution_end) ASC",
            "drill_down": {
                "status": "/api/1/query/migrations_by_status/status/$"
            }
        },
        "migrations_by_week": {
            "sql": "select EXTRACT(week FROM DATE(task.execution_end)), status, count (status) from task where task.name like '%igrationTask%' group by EXTRACT(week FROM DATE(task.execution_end)), status order by EXTRACT(week FROM DATE(task.execution_end)) ASC"
        },
        "windows_migrations": {
            "sql": "select distinct sm.host, s.source_machine_ref, av.attribute_category_id, av.attribute_name, av.attribute_value_string, t.id, t.status, DATE(t.execution_start) from attribute_value av, source_machine sm, attribute_collection ac, step s, task t where t.name like '%igrationTask%' and DATE(t.execution_start) >  %(date_since)s and s.task_id = t.id and s.source_machine_ref = sm.id and ac.host = sm.host and ac.id = av.attribute_collection_id and av.attribute_category_id = 7 and av.attribute_name like '%CPU Architecture%' and av.attribute_value_string like '%Windows%'",
            "params": [{
                "label": "Starting date (YYYY-MM-DD)",
                "name": "date_since"
            }]
        },
        "linux migrations": {
            "sql": "select distinct sm.host, s.source_machine_ref, av.attribute_value_string, t.id, t.status, DATE(t.execution_start) from attribute_value av, source_machine sm, attribute_collection ac, step s, task t where t.name like '%igrationTask%' and DATE(t.execution_start) > %(date_since)s and s.task_id = t.id and s.source_machine_ref = sm.id and ac.host = sm.host and ac.id = av.attribute_collection_id and av.attribute_category_id = 7 and av.attribute_name like '%Description%'",
            "params": [{
                "label": "Starting date (YYYY-MM-DD)",
                "name": "date_since"
            }]
        },
        "migrations_by_id_1.15": {
            "sql": "SELECT step.task_id AS \"Migration ID\", source_machine.host AS \"Source IP\", source_machine.description AS \"Source Hostname\", source_machine.os AS \"Operating System\", source_machine.available_drives AS \"Volumes\", target_vm.vm_name AS \"Target Name\", step.name AS \"Step Name\", step.status AS \"Status\", step.execution_start AS \"Step Start Time\",  step.execution_end AS \"Step End Time\", task.executed_system_id AS \"RiverMeadow Server\", step.status_description AS \"Notes\", users.email_address AS \"Account\" FROM step full outer join target_vm on step.target_vm_ref=target_vm.id full outer join source_machine on step.source_machine_ref=source_machine.id join task on task.id=step.task_id join users on task.executed_by=users.uuid WHERE step.task_id=%(migration_id)s ORDER BY step.execution_start ASC",
            "params": [{
                "label": "Migration ID",
                "name": "migration_id"
            }]
        }
    }
}
